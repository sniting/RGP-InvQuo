<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revathie Gear Products - Document Generation System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Page Management */
        .page {
            display: none;
            min-height: 100vh;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Launch Page Styles */
        .launch-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(59, 130, 246, 0.5);
            border-radius: 50%;
            animation: float 10s infinite linear;
        }
        
        @keyframes float {
            from { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            to { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }
        
        .launch-content {
            text-align: center;
            z-index: 10;
            position: relative;
            max-width: 1200px;
            padding: 20px;
        }
        
        .launch-logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .launch-title {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .launch-subtitle {
            font-size: 1.2em;
            color: #94a3b8;
            margin-bottom: 50px;
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }
        
        .service-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 2px solid rgba(59, 130, 246, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .service-card:hover {
            transform: translateY(-10px);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3);
        }
        
        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(59, 130, 246, 0.1));
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .service-card:hover::before {
            transform: translateX(100%);
        }
        
        .service-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }
        
        .service-title {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #3b82f6;
        }
        
        .service-description {
            color: #94a3b8;
            font-size: 0.95em;
        }
        
        .coming-soon {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: bold;
        }
        
        /* Back Button */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            z-index: 100;
            font-weight: 600;
        }
        
        .back-button:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(-5px);
        }
        
        /* Main Container Styles */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 80px;
        }
        
        /* Variables for theming */
        :root {
            --primary: #3b82f6;
            --secondary: #60a5fa;
            --accent: #f59e0b;
            --bg-dark: #0f172a;
            --bg-medium: #1e293b;
            --bg-light: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: rgba(59, 130, 246, 0.3);
        }
        
        /* Animated Background */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Form Styles */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .form-column {
            animation: slideInLeft 0.8s ease-out;
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .form-section {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
        }
        
        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        }
        
        .form-section h2 {
            font-size: 1.4em;
            margin-bottom: 20px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-section h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(15, 23, 42, 0.7);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(15, 23, 42, 0.9);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        /* Items Section */
        .items-section {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(96, 165, 250, 0.1));
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }
        
        .item-entry {
            background: rgba(15, 23, 42, 0.7);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            position: relative;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .item-number {
            font-weight: bold;
            color: var(--secondary);
            font-size: 1.1em;
        }
        
        .item-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .remove-item {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .remove-item:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: scale(1.05);
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .add-item-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            font-size: 1em;
            padding: 12px 25px;
            width: 100%;
            margin-top: 15px;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            font-size: 0.9em;
            padding: 10px 20px;
        }
        
        .sample-btn {
            background: linear-gradient(135deg, var(--accent), #d97706);
            font-size: 0.9em;
            padding: 10px 20px;
        }
        
        /* Transport Section */
        .transport-section {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(245, 158, 11, 0.3);
            margin-top: 15px;
        }
        
        /* Preview Section */
        .preview-section {
            position: sticky;
            top: 20px;
            height: fit-content;
            animation: fadeIn 0.8s ease-out 0.5s both;
        }
        
        .preview-container {
            background: rgba(31, 41, 55, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        .preview-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .preview-header h3 {
            font-size: 1.3em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .preview-content {
            background: white;
            color: black;
            min-height: 500px;
            max-height: 700px;
            overflow-y: auto;
            padding: 20px;
        }
        
        /* Preview Invoice Styles */
        .preview-invoice {
            font-size: 12px;
            color: #000;
        }
        
        .preview-invoice table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .preview-invoice th, .preview-invoice td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }
        
        .preview-invoice th {
            background: #f0f0f0;
            font-weight: bold;
        }
        
        /* Status Messages */
        .status-message {
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .status-message.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.2));
            border: 2px solid #10b981;
            color: #10b981;
        }
        
        .status-message.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.2));
            border: 2px solid #ef4444;
            color: #ef4444;
        }
        
        /* Loading Animation */
        .loading-gear {
            display: inline-block;
            animation: spin 2s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Header Styles */
        .header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(96, 165, 250, 0.1));
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 1.1em;
        }
        
        /* Test Buttons Container */
        .test-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .preview-section {
                position: static;
                margin-top: 30px;
            }
            
            .services-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .main-container {
                padding: 15px;
            }
            
            .launch-title {
                font-size: 2em;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div id="particles" class="particles"></div>
    
    <!-- Launch Page -->
    <div id="launchPage" class="page active">
        <div class="launch-container">
            <div class="launch-content">
                <div class="launch-logo">RGP</div>
                <h1 class="launch-title">Revathie Gear Products</h1>
                <p class="launch-subtitle">Professional Document Generation System</p>
                
                <div class="services-grid">
                    <div class="service-card" onclick="navigateTo('invoicePage')">
                        <span class="service-icon">üìã</span>
                        <h3 class="service-title">Invoice</h3>
                        <p class="service-description">Generate invoice on the go</p>
                    </div>
                    
                    <div class="service-card" onclick="navigateTo('quotationPage')">
                        <span class="service-icon">üí∞</span>
                        <h3 class="service-title">Quotation</h3>
                        <p class="service-description">Generate quotation on the go</p>
                    </div>
                    
                    <div class="service-card" onclick="showComingSoon()">
                        <span class="service-icon">üóÑÔ∏è</span>
                        <h3 class="service-title">Database</h3>
                        <p class="service-description">Deep dive into the Database</p>
                        <span class="coming-soon">Coming Soon</span>
                    </div>
                    
                    <div class="service-card" onclick="showComingSoon()">
                        <span class="service-icon">üìÑ</span>
                        <h3 class="service-title">Other Documents</h3>
                        <p class="service-description">Manage additional documents</p>
                        <span class="coming-soon">Coming Soon</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Invoice Page -->
    <div id="invoicePage" class="page">
        <button class="back-button" onclick="navigateTo('launchPage')">
            <span>‚Üê</span>
            <span>Back to Dashboard</span>
        </button>
        
        <div class="main-container">
            <header class="header">
                <h1>Revathie Gear Products</h1>
                <p>Advanced Invoice Generation System</p>
            </header>
            
            <div class="content-grid">
                <div class="form-column">
                    <div class="test-buttons">
                        <button class="btn sample-btn" onclick="loadSampleData()">
                            <span>Load Sample Data</span>
                        </button>
                        <button class="btn test-btn" onclick="testConnection()">
                            <span>Test Connection</span>
                        </button>
                    </div>
                    
                    <form id="invoiceForm">
                        <div class="form-section">
                            <h2>Client Information</h2>
                            <div class="form-group">
                                <label>Client Name *</label>
                                <input type="text" name="client_name" required placeholder="e.g., M/S. ABC Industries">
                            </div>
                            <div class="form-group">
                                <label>Client Address *</label>
                                <textarea name="client_address" rows="3" required placeholder="Enter complete address"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Client GST No.</label>
                                <input type="text" name="client_gst" placeholder="e.g., 29ABCDE1234F1Z5">
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h2>Invoice Details</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Invoice No. *</label>
                                    <input type="text" name="invoice_no" required placeholder="e.g., RGP-2024-001">
                                </div>
                                <div class="form-group">
                                    <label>Date *</label>
                                    <input type="date" name="date" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>DC No.</label>
                                    <input type="text" name="dc_no" placeholder="e.g., DC-2024-001">
                                </div>
                                <div class="form-group">
                                    <label>DC Date</label>
                                    <input type="date" name="dc_date">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Despatch Through</label>
                                    <input type="text" name="despatch_through" placeholder="e.g., By Hand / Courier">
                                </div>
                                <div class="form-group">
                                    <label>Document Through</label>
                                    <input type="text" name="document_through" placeholder="e.g., Original">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section items-section">
                            <h2>Items</h2>
                            <div id="itemsContainer"></div>
                            <button type="button" class="btn add-item-btn" onclick="addItem()">
                                <span>+ Add Item</span>
                            </button>
                        </div>
                        
                        <div class="form-section transport-section">
                            <h2>Additional Charges</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Transport Charge</label>
                                    <input type="number" name="transport_charge" placeholder="0" step="0.01" onchange="updatePreview()">
                                </div>
                                <div class="form-group">
                                    <label>HSN Code</label>
                                    <input type="text" name="hsn" value="995469" placeholder="HSN Code">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Labour Charges Description</label>
                                <input type="text" name="labour_charges_text" placeholder="e.g., LABOUR CHARGES FOR REPAIR WORKS">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tax Rate (%)</label>
                                    <input type="number" name="tax_rate" value="18" step="0.01" onchange="updatePreview()">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" name="inter_state" onchange="updatePreview()">
                                        Inter-State Transaction (IGST)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                            <span>Generate Invoice</span>
                        </button>
                        
                        <div id="statusMessage" class="status-message" style="display: none;"></div>
                    </form>
                </div>
                
                <div class="preview-section">
                    <div class="preview-container">
                        <div class="preview-header">
                            <h3>Live Preview</h3>
                        </div>
                        <div class="preview-content" id="previewContent">
                            <p style="text-align: center; color: #999; padding: 50px;">
                                Fill in the form to see a live preview of your invoice
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quotation Page -->
    <div id="quotationPage" class="page">
        <button class="back-button" onclick="navigateTo('launchPage')">
            <span>‚Üê</span>
            <span>Back to Dashboard</span>
        </button>
        
        <div class="main-container">
            <header class="header">
                <h1>Revathie Gear Products</h1>
                <p>Professional Quotation Generation System</p>
            </header>
            
            <div class="content-grid">
                <div class="form-column">
                    <div class="test-buttons">
                        <button class="btn sample-btn" onclick="loadQuotationSampleData()">
                            <span>Load Sample Data</span>
                        </button>
                        <button class="btn test-btn" onclick="testQuotationConnection()">
                            <span>Test Connection</span>
                        </button>
                    </div>
                    
                    <form id="quotationForm">
                        <div class="form-section">
                            <h2>Document Details</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Quotation Reference *</label>
                                    <input type="text" name="quotation_ref" placeholder="e.g., RGP/QTN-055/2025-26" required>
                                </div>
                                <div class="form-group">
                                    <label>Quotation Date *</label>
                                    <input type="date" name="quotation_date" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Quotation Validity Period</label>
                                <select name="validity_period">
                                    <option value="15">15 Days</option>
                                    <option value="30" selected>30 Days</option>
                                    <option value="45">45 Days</option>
                                    <option value="60">60 Days</option>
                                    <option value="90">90 Days</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h2>Customer Information</h2>
                            <div class="form-group">
                                <label>Company Name *</label>
                                <input type="text" name="customer_company" placeholder="e.g., M/S. XYZ Corporation" required>
                            </div>
                            <div class="form-group">
                                <label>Company Address *</label>
                                <textarea name="customer_address" rows="3" placeholder="Enter complete address" required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>GST Number</label>
                                    <input type="text" name="customer_gst" placeholder="e.g., 29ABCDE1234F1Z5">
                                </div>
                                <div class="form-group">
                                    <label>Contact Person</label>
                                    <input type="text" name="contact_person" placeholder="e.g., Mr. John Doe">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Contact Phone</label>
                                    <input type="tel" name="contact_phone" placeholder="e.g., +91 98765 43210">
                                </div>
                                <div class="form-group">
                                    <label>Contact Email</label>
                                    <input type="email" name="contact_email" placeholder="e.g., contact@company.com">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section items-section">
                            <h2>Quotation Items</h2>
                            <div id="quotationItemsContainer"></div>
                            <button type="button" class="btn add-item-btn" onclick="addQuotationItem()">
                                <span>+ Add Item</span>
                            </button>
                        </div>
                        
                        <div class="form-section">
                            <h2>Terms & Conditions</h2>
                            <div class="form-group">
                                <label>Delivery Terms</label>
                                <input type="text" name="delivery_terms" placeholder="e.g., Within 30 days from order confirmation" value="Within 30 days from the date of order confirmation">
                            </div>
                            <div class="form-group">
                                <label>Payment Terms</label>
                                <input type="text" name="payment_terms" placeholder="e.g., 50% Advance, Balance before delivery" value="50% Advance, Balance before delivery">
                            </div>
                            <div class="form-group">
                                <label>Additional Terms</label>
                                <textarea name="additional_terms" rows="2" placeholder="Any additional terms or conditions"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Special Notes</label>
                                <textarea name="special_notes" rows="2" placeholder="Any special notes or highlights"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>HSN Code</label>
                                    <input type="text" name="hsn" value="995469" placeholder="HSN Code">
                                </div>
                                <div class="form-group">
                                    <label>Tax Rate (%)</label>
                                    <input type="number" name="tax_rate" value="18" step="0.01" onchange="updateQuotationPreview()">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="inter_state" onchange="updateQuotationPreview()">
                                    Inter-State Transaction (IGST)
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" id="generateQuotationBtn" class="btn" style="width: 100%; margin-top: 20px;">
                            <span>Generate Quotation</span>
                        </button>
                        
                        <div id="quotationStatusMessage" class="status-message" style="display: none;"></div>
                    </form>
                </div>
                
                <div class="preview-section">
                    <div class="preview-container">
                        <div class="preview-header">
                            <h3>Quotation Preview</h3>
                        </div>
                        <div class="preview-content" id="quotationPreviewArea">
                            <p style="text-align: center; color: #999; padding: 50px;">
                                Fill in the form to see a live preview of your quotation
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Production Webhook URLs - SEPARATE FOR INVOICE AND QUOTATION
        const INVOICE_WEBHOOK_URL = 'https://sngsng.app.n8n.cloud/webhook/invoice-generator-v4';
        const QUOTATION_WEBHOOK_URL = 'https://sngsng.app.n8n.cloud/webhook/quotation-generator-pro';
        
        // Navigation functions
        function navigateTo(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }
        
        function showComingSoon() {
            alert('This feature is coming soon!\n\nWe\'re working hard to bring you more amazing functionality.');
        }
        
        // Generate particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (10 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        createParticles();
        
        // Set today's date when navigating to invoice page
        document.getElementById('invoicePage').addEventListener('click', function() {
            const dateInput = document.querySelector('input[name="date"]');
            if (dateInput && !dateInput.value) {
                dateInput.valueAsDate = new Date();
            }
        });
        
        let itemCount = 0;
        
        // Function to convert number to words (Indian numbering system)
        function numberToWords(num) {
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            
            if (num === 0) return 'Zero';
            
            // Handle up to 99,99,999 (Indian numbering)
            const crore = Math.floor(num / 10000000);
            const lakh = Math.floor((num % 10000000) / 100000);
            const thousand = Math.floor((num % 100000) / 1000);
            const hundred = Math.floor((num % 1000) / 100);
            const remainder = num % 100;
            
            let words = '';
            
            if (crore > 0) {
                words += numberToWords(crore) + ' Crore ';
            }
            
            if (lakh > 0) {
                words += numberToWords(lakh) + ' Lakh ';
            }
            
            if (thousand > 0) {
                words += numberToWords(thousand) + ' Thousand ';
            }
            
            if (hundred > 0) {
                words += ones[hundred] + ' Hundred ';
            }
            
            if (remainder >= 20) {
                words += tens[Math.floor(remainder / 10)] + ' ';
                if (remainder % 10 > 0) {
                    words += ones[remainder % 10] + ' ';
                }
            } else if (remainder >= 10) {
                words += teens[remainder - 10] + ' ';
            } else if (remainder > 0) {
                words += ones[remainder] + ' ';
            }
            
            return words.trim() + ' Only';
        }
        
        // Invoice Functions
        function addItem() {
            itemCount++;
            const container = document.getElementById('itemsContainer');
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-entry';
            itemDiv.id = 'item-' + itemCount;
            
            itemDiv.innerHTML = `
                <div class="item-header">
                    <span class="item-number">Item ${itemCount}</span>
                    ${itemCount > 1 ? `<button type="button" class="remove-item" onclick="removeItem(${itemCount})">Remove</button>` : ''}
                </div>
                <div class="item-fields">
                    <div class="form-group">
                        <label>Item Name/Description *</label>
                        <input type="text" name="item_name_${itemCount}" required placeholder="e.g., Gear Wheel" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Service Type</label>
                        <input type="text" name="item_service_${itemCount}" placeholder="e.g., Repair/Manufacturing" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Additional Details</label>
                        <textarea name="item_details_${itemCount}" rows="2" placeholder="Any additional details" onchange="updatePreview()"></textarea>
                    </div>
                    <div class="item-row">
                        <div class="form-group">
                            <label>Quantity *</label>
                            <input type="number" name="item_qty_${itemCount}" min="1" required placeholder="1" onchange="calculateAmount(${itemCount})">
                        </div>
                        <div class="form-group">
                            <label>Rate (‚Çπ) *</label>
                            <input type="number" name="item_rate_${itemCount}" step="0.01" required placeholder="0.00" onchange="calculateAmount(${itemCount})">
                        </div>
                        <div class="form-group">
                            <label>Amount (‚Çπ)</label>
                            <input type="number" name="item_amount_${itemCount}" step="0.01" readonly placeholder="0.00">
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(itemDiv);
            if (itemCount === 1) {
                updatePreview();
            }
        }
        
        function removeItem(id) {
            const item = document.getElementById('item-' + id);
            item.style.animation = 'slideOut 0.3s ease-out';
            setTimeout(() => {
                item.remove();
                updatePreview();
            }, 300);
        }
        
        function calculateAmount(itemId) {
            const qty = document.querySelector(`input[name="item_qty_${itemId}"]`).value || 0;
            const rate = document.querySelector(`input[name="item_rate_${itemId}"]`).value || 0;
            const amount = qty * rate;
            document.querySelector(`input[name="item_amount_${itemId}"]`).value = amount.toFixed(2);
            updatePreview();
        }
        
        function updatePreview() {
            const formData = new FormData(document.getElementById('invoiceForm'));
            const data = Object.fromEntries(formData);
            
            let itemsHtml = '';
            let subtotal = 0;
            
            for (let i = 1; i <= itemCount; i++) {
                if (document.getElementById('item-' + i)) {
                    const name = data['item_name_' + i] || '';
                    const service = data['item_service_' + i] || '';
                    const details = data['item_details_' + i] || '';
                    const qty = data['item_qty_' + i] || 0;
                    const rate = parseFloat(data['item_rate_' + i] || 0);
                    const amount = parseFloat(data['item_amount_' + i] || 0);
                    
                    if (name) {
                        itemsHtml += `
                            <tr>
                                <td style="border: 1px solid #000; padding: 10px; text-align: center;">${i}</td>
                                <td style="border: 1px solid #000; padding: 10px;">
                                    <strong>${name}</strong>
                                    ${service ? '<br>Service: ' + service : ''}
                                    ${details ? '<br>' + details : ''}
                                </td>
                                <td style="border: 1px solid #000; padding: 10px; text-align: center;">${qty}</td>
                                <td style="border: 1px solid #000; padding: 10px; text-align: right;">${rate.toFixed(2)}</td>
                                <td style="border: 1px solid #000; padding: 10px; text-align: right;">${amount.toFixed(2)}</td>
                            </tr>
                        `;
                        subtotal += amount;
                    }
                }
            }
            
            const transportCharge = parseFloat(data.transport_charge || 0);
            subtotal += transportCharge;
            
            const taxRate = parseFloat(data.tax_rate || 18);
            const isInterState = data.inter_state === 'on';
            
            let cgst = 0, sgst = 0, igst = 0;
            if (isInterState) {
                igst = (subtotal * taxRate) / 100;
            } else {
                cgst = (subtotal * taxRate) / 200;
                sgst = (subtotal * taxRate) / 200;
            }
            
            const total = subtotal + cgst + sgst + igst;
            
            const labourChargesText = data.labour_charges_text || 'LABOUR CHARGES FOR REPAIR WORKS';
            const hsnSection = labourChargesText ? 
                `<strong>HSN: ${data.hsn || '995469'}</strong><br><strong>${labourChargesText}</strong>` :
                `<strong>HSN: ${data.hsn || '995469'}</strong>`;
            
            const previewHtml = `
                <div style="padding: 20px; font-size: 12px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h2 style="color: #1e3a8a; margin: 0;">REVATHIE GEAR PRODUCTS</h2>
                        <p style="margin: 5px 0;">Professional Invoice</p>
                    </div>
                    
                    <table style="width: 100%; margin-bottom: 20px; border: 1px solid #000;">
                        <tr>
                            <td style="padding: 15px; width: 50%; vertical-align: top; border-right: 1px solid #000;">
                                <strong>TO:</strong><br>
                                <strong>${data.client_name || 'Client Name'}</strong><br>
                                ${(data.client_address || '').replace(/\n/g, '<br>')}<br>
                                ${data.client_gst ? 'GST: ' + data.client_gst : ''}
                            </td>
                            <td style="padding: 15px; vertical-align: top;">
                                <strong>Invoice No:</strong> ${data.invoice_no || '---'}<br>
                                <strong>Date:</strong> ${data.date ? new Date(data.date).toLocaleDateString('en-GB') : '---'}<br>
                                <strong>DC No:</strong> ${data.dc_no || '---'}<br>
                                <strong>DC Date:</strong> ${data.dc_date ? new Date(data.dc_date).toLocaleDateString('en-GB') : '---'}<br>
                                <strong>Despatch:</strong> ${data.despatch_through || '---'}<br>
                                <strong>Document:</strong> ${data.document_through || '---'}
                            </td>
                        </tr>
                    </table>
                    
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f0f0f0;">
                                <th style="border: 1px solid #000; padding: 10px; width: 8%;">S.No</th>
                                <th style="border: 1px solid #000; padding: 10px; width: 50%;">Description</th>
                                <th style="border: 1px solid #000; padding: 10px; width: 12%;">Qty</th>
                                <th style="border: 1px solid #000; padding: 10px; width: 15%;">Rate/Nos</th>
                                <th style="border: 1px solid #000; padding: 10px; width: 15%;">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5" style="border: 1px solid #000; padding: 10px;">
                                    ${hsnSection}
                                </td>
                            </tr>
                            ${itemsHtml}
                            ${transportCharge > 0 ? `
                            <tr>
                                <td colspan="4" style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    <strong>Transport Charge</strong>
                                </td>
                                <td style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    ${transportCharge.toFixed(2)}
                                </td>
                            </tr>
                            ` : ''}
                            <tr>
                                <td colspan="4" style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    <strong>Subtotal</strong>
                                </td>
                                <td style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    ${subtotal.toFixed(2)}
                                </td>
                            </tr>
                            ${isInterState ? `
                            <tr>
                                <td colspan="4" style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    IGST @ ${taxRate}%
                                </td>
                                <td style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    ${igst.toFixed(2)}
                                </td>
                            </tr>
                            ` : `
                            <tr>
                                <td colspan="4" style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    CGST @ ${taxRate/2}%
                                </td>
                                <td style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    ${cgst.toFixed(2)}
                                </td>
                            </tr>
                            <tr>
                                <td colspan="4" style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    SGST @ ${taxRate/2}%
                                </td>
                                <td style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    ${sgst.toFixed(2)}
                                </td>
                            </tr>
                            `}
                            <tr style="background: #f0f0f0;">
                                <td colspan="4" style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    <strong>TOTAL</strong>
                                </td>
                                <td style="border: 1px solid #000; padding: 10px; text-align: right;">
                                    <strong>‚Çπ ${total.toFixed(2)}</strong>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                        <strong>Amount in Words:</strong> ${numberToWords(Math.floor(total))} Rupees
                    </div>
                </div>
            `;
            
            document.getElementById('previewContent').innerHTML = previewHtml;
        }
        
        function loadSampleData() {
            document.querySelector('input[name="client_name"]').value = 'M/S. Sample Industries Pvt. Ltd.';
            document.querySelector('textarea[name="client_address"]').value = 'No. 123, Industrial Estate\nChennai - 600058';
            document.querySelector('input[name="client_gst"]').value = '33SAMPLE1234G1ZX';
            document.querySelector('input[name="invoice_no"]').value = 'RGP-2025-001';
            document.querySelector('input[name="date"]').valueAsDate = new Date();
            document.querySelector('input[name="dc_no"]').value = 'DC-2025-001';
            document.querySelector('input[name="dc_date"]').valueAsDate = new Date();
            document.querySelector('input[name="despatch_through"]').value = 'By Hand';
            document.querySelector('input[name="document_through"]').value = 'Original';
            
            if (itemCount === 0) {
                addItem();
            }
            document.querySelector('input[name="item_name_1"]').value = 'Gear Wheel Repair';
            document.querySelector('input[name="item_service_1"]').value = 'Repair & Reconditioning';
            document.querySelector('textarea[name="item_details_1"]').value = 'Bore reconditioning with bush fitting';
            document.querySelector('input[name="item_qty_1"]').value = '2';
            document.querySelector('input[name="item_rate_1"]').value = '5000';
            calculateAmount(1);
            
            document.querySelector('input[name="transport_charge"]').value = '500';
            document.querySelector('input[name="hsn"]').value = '995469';
            document.querySelector('input[name="labour_charges_text"]').value = 'LABOUR CHARGES FOR GEAR REPAIR WORKS';
            
            updatePreview();
        }
        
        // Initialize with one item
        addItem();
        
        // Form submission for INVOICE
        document.getElementById('invoiceForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = e.target.querySelector('button[type="submit"]');
            const statusMsg = document.getElementById('statusMessage');
            
            btn.disabled = true;
            btn.innerHTML = 'Generating<span class="loading-gear">‚öô</span>';
            statusMsg.style.display = 'none';
            
            // Prepare data
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            // Structure items
            const items = [];
            for (let i = 1; i <= itemCount; i++) {
                if (document.getElementById('item-' + i)) {
                    const item = {
                        name: data['item_name_' + i] || '',
                        service: data['item_service_' + i] || '',
                        details: data['item_details_' + i] || '',
                        qty: data['item_qty_' + i] || '',
                        rate: data['item_rate_' + i] || '0',
                        amount: data['item_amount_' + i] || '0'
                    };
                    items.push(item);
                }
            }
            
            // Prepare invoice data
            const invoiceData = {
                client_name: data.client_name,
                client_address: data.client_address,
                client_gst: data.client_gst,
                invoice_no: data.invoice_no,
                date: data.date,
                dc_no: data.dc_no,
                dc_date: data.dc_date,
                despatch_through: data.despatch_through,
                document_through: data.document_through,
                items: items,
                transport_charge: data.transport_charge || '0',
                hsn: data.hsn,
                labour_charges_text: data.labour_charges_text,
                tax_rate: data.tax_rate,
                inter_state: data.inter_state === 'on'
            };
            
            try {
                const response = await fetch(INVOICE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(invoiceData)
                });
                
                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    
                    if (contentType && contentType.includes('application/pdf')) {
                        // Handle PDF response
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'Invoice_' + invoiceData.invoice_no + '.pdf';
                        a.click();
                        window.URL.revokeObjectURL(url);
                        
                        statusMsg.className = 'status-message success';
                        statusMsg.innerHTML = '‚úÖ Invoice PDF downloaded successfully!';
                    } else if (contentType && contentType.includes('text/html')) {
                        // Handle HTML response - open in new window with print dialog
                        const html = await response.text();
                        const newWindow = window.open('', '_blank');
                        newWindow.document.write(html);
                        newWindow.document.close();
                        
                        // Auto-trigger print dialog after a short delay
                        setTimeout(() => {
                            newWindow.print();
                        }, 1000);
                        
                        statusMsg.className = 'status-message success';
                        statusMsg.innerHTML = '‚úÖ Invoice opened! Use Print or Save as PDF from the browser.';
                    } else if (contentType && contentType.includes('application/json')) {
                        // Handle JSON response (likely test response)
                        const data = await response.json();
                        statusMsg.className = 'status-message success';
                        statusMsg.innerHTML = '‚úÖ ' + (data.message || 'Request processed successfully!');
                    }
                    statusMsg.style.display = 'block';
                } else {
                    const errorText = await response.text();
                    throw new Error('Failed to generate invoice: ' + errorText);
                }
            } catch (error) {
                statusMsg.className = 'status-message error';
                statusMsg.innerHTML = '‚ùå ' + error.message;
                statusMsg.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Generate Invoice';
            }
        });
        
        // Test connection for INVOICE
        async function testConnection() {
            const statusMsg = document.getElementById('statusMessage');
            statusMsg.style.display = 'none';
            
            try {
                const response = await fetch(INVOICE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test: true })
                });
                
                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        const data = await response.json();
                        statusMsg.className = 'status-message success';
                        statusMsg.innerHTML = '‚úÖ ' + (data.message || 'Connection successful!');
                    } else {
                        statusMsg.className = 'status-message success';
                        statusMsg.innerHTML = '‚úÖ Connection successful! Webhook is active.';
                    }
                } else {
                    statusMsg.className = 'status-message error';
                    statusMsg.innerHTML = '‚ùå Connection failed. Check n8n workflow.';
                }
            } catch (error) {
                statusMsg.className = 'status-message error';
                statusMsg.innerHTML = '‚ùå Cannot connect to webhook: ' + error.message;
            }
            
            statusMsg.style.display = 'block';
        }
        
        // Add slide out animation
        const style = document.createElement('style');
        style.textContent = '@keyframes slideOut { to { transform: translateX(-100%); opacity: 0; } }';
        document.head.appendChild(style);
        
        // Quotation Page Functions
        let quotationItemCount = 0;
        
        // Set today's date for quotation when page loads
        document.getElementById('quotationPage').addEventListener('click', function() {
            const dateInput = document.querySelector('input[name="quotation_date"]');
            if (dateInput && !dateInput.value) {
                dateInput.valueAsDate = new Date();
            }
        });
        
        function addQuotationItem() {
            quotationItemCount++;
            const container = document.getElementById('quotationItemsContainer');
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-entry';
            itemDiv.id = 'quotation-item-' + quotationItemCount;
            
            itemDiv.innerHTML = `
                <div class="item-header">
                    <span class="item-number">Item ${quotationItemCount}</span>
                    ${quotationItemCount > 1 ? `<button type="button" class="remove-item" onclick="removeQuotationItem(${quotationItemCount})">Remove</button>` : ''}
                </div>
                <div class="item-fields">
                    <div class="form-group">
                        <label>Item Description *</label>
                        <textarea name="q_item_description_${quotationItemCount}" rows="2" placeholder="e.g., Slow speed Gear, Intermediate pinion" required onchange="updateQuotationPreview()"></textarea>
                    </div>
                    <div class="item-row">
                        <div class="form-group">
                            <label>Additional Info</label>
                            <input type="text" name="q_item_info_${quotationItemCount}" placeholder="e.g., Bore Recondition Charges" onchange="updateQuotationPreview()">
                        </div>
                        <div class="form-group">
                            <label>Quantity *</label>
                            <input type="number" name="q_item_qty_${quotationItemCount}" min="1" required placeholder="1" onchange="calculateQuotationAmount(${quotationItemCount})">
                        </div>
                        <div class="form-group">
                            <label>Rate (‚Çπ) *</label>
                            <input type="number" name="q_item_rate_${quotationItemCount}" step="0.01" required placeholder="0.00" onchange="calculateQuotationAmount(${quotationItemCount})">
                        </div>
                        <div class="form-group">
                            <label>Amount (‚Çπ)</label>
                            <input type="number" name="q_item_amount_${quotationItemCount}" step="0.01" readonly placeholder="0.00">
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(itemDiv);
            if (quotationItemCount === 1) {
                updateQuotationPreview();
            }
        }
        
        function removeQuotationItem(id) {
            const item = document.getElementById('quotation-item-' + id);
            item.style.animation = 'slideOut 0.3s ease-out';
            setTimeout(() => {
                item.remove();
                updateQuotationPreview();
            }, 300);
        }
        
        function calculateQuotationAmount(itemId) {
            const qty = document.querySelector(`input[name="q_item_qty_${itemId}"]`).value || 0;
            const rate = document.querySelector(`input[name="q_item_rate_${itemId}"]`).value || 0;
            const amount = qty * rate;
            document.querySelector(`input[name="q_item_amount_${itemId}"]`).value = amount.toFixed(2);
            updateQuotationPreview();
        }
        
        function updateQuotationPreview() {
            const formData = new FormData(document.getElementById('quotationForm'));
            const data = Object.fromEntries(formData);
            
            let itemsHtml = '';
            let subtotal = 0;
            
            for (let i = 1; i <= quotationItemCount; i++) {
                if (document.getElementById('quotation-item-' + i)) {
                    const description = data['q_item_description_' + i] || '';
                    const info = data['q_item_info_' + i] || '';
                    const qty = data['q_item_qty_' + i] || 0;
                    const rate = parseFloat(data['q_item_rate_' + i] || 0);
                    const amount = parseFloat(data['q_item_amount_' + i] || 0);
                    
                    if (description) {
                        itemsHtml += `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">${i}</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">
                                    <strong>${description}</strong>
                                    ${info ? '<br><em style="color: #666; font-size: 0.9em;">' + info + '</em>' : ''}
                                </td>
                                <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">${qty}</td>
                                <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">‚Çπ${rate.toFixed(2)}</td>
                                <td style="border: 1px solid #ddd; padding: 10px; text-align: right;"><strong>‚Çπ${amount.toFixed(2)}</strong></td>
                            </tr>
                        `;
                        subtotal += amount;
                    }
                }
            }
            
            const taxRate = parseFloat(data.tax_rate || 18);
            const isInterState = data.inter_state === 'on';
            
            let cgst = 0, sgst = 0, igst = 0;
            if (isInterState) {
                igst = (subtotal * taxRate) / 100;
            } else {
                cgst = (subtotal * taxRate) / 200;
                sgst = (subtotal * taxRate) / 200;
            }
            
            const total = subtotal + cgst + sgst + igst;
            const taxInfo = isInterState ? `${taxRate}% IGST` : `${taxRate/2}% CGST + ${taxRate/2}% SGST`;
            
            const previewHtml = `
                <div style="padding: 20px; font-size: 12px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h2 style="color: #1e3a8a; margin: 0;">REVATHIE GEAR PRODUCTS</h2>
                        <p style="margin: 5px 0; font-size: 14pt; font-weight: bold;">QUOTATION</p>
                    </div>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div style="flex: 1; border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
                            <h3 style="color: #1e3a8a; margin-bottom: 10px;">Quotation Details</h3>
                            <strong>Reference:</strong> ${data.quotation_ref || 'QTN-001'}<br>
                            <strong>Date:</strong> ${data.quotation_date ? new Date(data.quotation_date).toLocaleDateString('en-GB') : '---'}<br>
                            <strong>Valid Till:</strong> ${data.validity_period || '30'} Days
                        </div>
                        <div style="flex: 1; border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
                            <h3 style="color: #1e3a8a; margin-bottom: 10px;">Customer Information</h3>
                            <strong>${data.customer_company || 'Company Name'}</strong><br>
                            ${(data.customer_address || '').replace(/\n/g, '<br>')}<br>
                            ${data.customer_gst ? 'GST: ' + data.customer_gst : ''}
                            ${data.contact_person ? '<br>Contact: ' + data.contact_person : ''}
                        </div>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white;">
                                <th style="border: 1px solid #ddd; padding: 12px; width: 8%;">S.No</th>
                                <th style="border: 1px solid #ddd; padding: 12px; width: 45%;">Item Description</th>
                                <th style="border: 1px solid #ddd; padding: 12px; width: 12%;">Qty</th>
                                <th style="border: 1px solid #ddd; padding: 12px; width: 17%;">Rate</th>
                                <th style="border: 1px solid #ddd; padding: 12px; width: 18%;">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml || '<tr><td colspan="5" style="padding: 20px; text-align: center; color: #999;">Add items to see preview</td></tr>'}
                        </tbody>
                    </table>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <div style="flex: 1.2;">
                            <h3 style="color: #1e3a8a; margin-bottom: 10px;">Terms & Conditions</h3>
                            <div style="margin: 8px 0;">1. DELIVERY : ${data.delivery_terms || 'Within 30 days from order confirmation'}</div>
                            <div style="margin: 8px 0;">2. GST : ${taxInfo} as applicable</div>
                            <div style="margin: 8px 0;">3. PAYMENT : ${data.payment_terms || '50% Advance, Balance before delivery'}</div>
                            ${data.additional_terms ? '<div style="margin: 8px 0;">4. ' + data.additional_terms + '</div>' : ''}
                        </div>
                        <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; border: 2px solid #d1d5db; min-width: 250px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                                <span>Subtotal</span>
                                <span>‚Çπ${subtotal.toFixed(2)}</span>
                            </div>
                            ${isInterState ? `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                                <span>IGST (${taxRate}%)</span>
                                <span>‚Çπ${igst.toFixed(2)}</span>
                            </div>
                            ` : `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                                <span>CGST (${taxRate/2}%)</span>
                                <span>‚Çπ${cgst.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                                <span>SGST (${taxRate/2}%)</span>
                                <span>‚Çπ${sgst.toFixed(2)}</span>
                            </div>
                            `}
                            <div style="display: flex; justify-content: space-between; padding: 12px 0 8px 0; border-top: 2px solid #1e3a8a; margin-top: 8px; font-size: 14pt; font-weight: bold; color: #1e3a8a;">
                                <span>TOTAL</span>
                                <span>‚Çπ${total.toFixed(2)}</span>
                            </div>
                            <div style="background: #1e3a8a; color: white; padding: 10px; border-radius: 5px; margin-top: 10px; text-align: center; font-weight: 600;">
                                ${numberToWords(Math.floor(total))} Rupees
                            </div>
                        </div>
                    </div>
                    
                    ${data.special_notes ? `
                    <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px 15px; margin: 20px 0; border-radius: 0 5px 5px 0;">
                        <strong style="color: #92400e;">Special Notes:</strong>
                        <div style="color: #78350f; margin-top: 5px;">${data.special_notes}</div>
                    </div>
                    ` : ''}
                    
                    <div style="margin-top: 40px; text-align: right; padding-right: 50px;">
                        <div>For REVATHIE GEAR PRODUCTS</div>
                        <div style="margin-top: 60px;">
                            <strong>SUBRAMANIAM R</strong><br>
                            PROPRIETOR
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('quotationPreviewArea').innerHTML = previewHtml;
        }
        
        function loadQuotationSampleData() {
            document.querySelector('input[name="quotation_ref"]').value = 'RGP/QTN-055/2025-26';
            document.querySelector('input[name="quotation_date"]').valueAsDate = new Date();
            document.querySelector('select[name="validity_period"]').value = '30';
            document.querySelector('input[name="customer_company"]').value = 'M/S. Tech Solutions Pvt. Ltd.';
            document.querySelector('textarea[name="customer_address"]').value = 'Plot No. 456, Tech Park\nOMR Road, Chennai - 600096';
            document.querySelector('input[name="customer_gst"]').value = '33TECH5678H1ZY';
            document.querySelector('input[name="contact_person"]').value = 'Mr. Rajesh Kumar';
            document.querySelector('input[name="contact_phone"]').value = '+91 98765 43210';
            document.querySelector('input[name="contact_email"]').value = 'rajesh@techsolutions.com';
            
            if (quotationItemCount === 0) {
                addQuotationItem();
            }
            document.querySelector('textarea[name="q_item_description_1"]').value = 'Helical Gear Set - Custom Manufacturing';
            document.querySelector('input[name="q_item_info_1"]').value = 'Material: EN8, Module: 2.5, Teeth: 45';
            document.querySelector('input[name="q_item_qty_1"]').value = '4';
            document.querySelector('input[name="q_item_rate_1"]').value = '8500';
            calculateQuotationAmount(1);
            
            document.querySelector('input[name="delivery_terms"]').value = 'Within 30 days from the date of order confirmation';
            document.querySelector('input[name="payment_terms"]').value = '50% Advance, Balance before delivery';
            document.querySelector('textarea[name="special_notes"]').value = 'Price valid for bulk orders above 10 units - 5% discount applicable';
            
            updateQuotationPreview();
        }
        
        // Initialize with one quotation item
        addQuotationItem();
        
        // Form submission for QUOTATION
        document.getElementById('quotationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('generateQuotationBtn');
            const statusMsg = document.getElementById('quotationStatusMessage');
            
            btn.disabled = true;
            btn.innerHTML = 'Generating<span class="loading-gear">‚öô</span>';
            statusMsg.style.display = 'none';
            
            // Prepare data
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            // Structure items  
            const items = [];
            for (let i = 1; i <= quotationItemCount; i++) {
                if (document.getElementById('quotation-item-' + i)) {
                    items.push({
                        q_item_description: data['q_item_description_' + i] || '',
                        q_item_info: data['q_item_info_' + i] || '',
                        q_item_qty: data['q_item_qty_' + i] || '',
                        q_item_rate: data['q_item_rate_' + i] || '0',
                        q_item_amount: data['q_item_amount_' + i] || '0'
                    });
                }
            }
            
            // Prepare quotation data for webhook
            const quotationData = {
                ...data,
                ...items.reduce((acc, item, index) => {
                    const num = index + 1;
                    acc[`q_item_description_${num}`] = item.q_item_description;
                    acc[`q_item_info_${num}`] = item.q_item_info;
                    acc[`q_item_qty_${num}`] = item.q_item_qty;
                    acc[`q_item_rate_${num}`] = item.q_item_rate;
                    acc[`q_item_amount_${num}`] = item.q_item_amount;
                    return acc;
                }, {})
            };
            
            try {
                const response = await fetch(QUOTATION_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(quotationData)
                });
                
                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    
                    if (contentType && contentType.includes('text/html')) {
                        // Handle HTML response - open in new window with print dialog
                        const html = await response.text();
                        const newWindow = window.open('', '_blank');
                        newWindow.document.write(html);
                        newWindow.document.close();
                        
                        // Auto-trigger print dialog after a short delay
                        setTimeout(() => {
                            newWindow.print();
                        }, 1000);
                        
                        statusMsg.className = 'status-message success';
                        statusMsg.innerHTML = '‚úÖ Quotation opened! Use Print or Save as PDF from the browser.';
                    } else if (contentType && contentType.includes('application/pdf')) {
                        // Handle PDF response
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'Quotation_' + quotationData.quotation_ref + '.pdf';
                        a.click();
                        window.URL.revokeObjectURL(url);
                        
                        statusMsg.className = 'status-message success';
                        statusMsg.innerHTML = '‚úÖ Quotation PDF downloaded successfully!';
                    } else {
                        statusMsg.className = 'status-message success';
                        statusMsg.innerHTML = '‚úÖ Quotation generated successfully!';
                    }
                    statusMsg.style.display = 'block';
                } else {
                    throw new Error('Failed to generate quotation. Check webhook configuration.');
                }
            } catch (error) {
                statusMsg.className = 'status-message error';
                statusMsg.innerHTML = '‚ùå ' + error.message;
                statusMsg.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Generate Quotation';
            }
        });
        
        // Test connection for QUOTATION
        async function testQuotationConnection() {
            const statusMsg = document.getElementById('quotationStatusMessage');
            statusMsg.style.display = 'none';
            
            try {
                const response = await fetch(QUOTATION_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test: true })
                });
                
                if (response.ok) {
                    statusMsg.className = 'status-message success';
                    statusMsg.innerHTML = '‚úÖ Quotation webhook connection successful!';
                } else {
                    statusMsg.className = 'status-message error';
                    statusMsg.innerHTML = '‚ùå Connection failed. Check quotation webhook in n8n.';
                }
            } catch (error) {
                statusMsg.className = 'status-message error';
                statusMsg.innerHTML = '‚ùå Cannot connect to quotation webhook: ' + error.message;
            }
            
            statusMsg.style.display = 'block';
            
            setTimeout(() => {
                statusMsg.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>